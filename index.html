<!DOCTYPE html>
<html lang="it">
<head>
<meta charset="UTF-8">
<title>Programmazione Turni</title>
<style>
  body {
    font-family: Arial, sans-serif;
    background: #f4f6f8;
    margin: 0;
    padding: 20px;
  }

  h1 { text-align: center; }

  .box {
    background: #fff;
    padding: 15px;
    margin-bottom: 20px;
    border-radius: 8px;
    box-shadow: 0 2px 6px rgba(0,0,0,0.1);
  }

  .grid {
    display: grid;
    grid-template-columns: repeat(auto-fill, minmax(220px, 1fr));
    gap: 10px;
  }

  button {
    padding: 10px 15px;
    border: none;
    border-radius: 6px;
    background: #1976d2;
    color: white;
    cursor: pointer;
  }

  button:hover {
    background: #125aa0;
  }

  textarea {
    width: 100%;
    height: 450px;
    border-radius: 6px;
    padding: 10px;
  }

  label { display: block; margin: 5px 0; }
</style>
</head>
<body>

<h1>Programmazione Turni</h1>

<div class="box">
  <button onclick="openAdmin()">Admin</button>
</div>

<div id="mainPanel">

  <div class="box">
    <h3>Lavoratori presenti</h3>
    <div id="presentList" class="grid"></div>
  </div>

  <div class="box">
    <h3>Dove hai più bisogno?</h3>
    <label><input type="radio" name="need" value="midi" checked> MIDI</label>
    <label><input type="radio" name="need" value="stammdaten"> STAMMDATEN</label>
  </div>

  <div class="box">
    <h3>Numero di rotazioni</h3>
    <select id="rotations">
      <option value="1">1 rotazione</option>
      <option value="2">2 rotazioni</option>
      <option value="3">3 rotazioni</option>
    </select>
  </div>

  <div class="box">
    <button onclick="generateRotations()">Genera programmazione</button>
  </div>

  <div class="box">
    <h3>Risultato</h3>
    <textarea id="output" readonly></textarea>
  </div>

</div>

<div id="adminPanel" class="box" style="display:none">
  <h3>Admin – Gestione Arbeiter</h3>
  <input id="newName" placeholder="Nome lavoratore">
  <button onclick="addWorker()">+</button>
  <ul id="workerList"></ul>
  <button onclick="closeAdmin()">Esci Admin</button>
</div>

<script>
/* ===== DATI ===== */
let workers = JSON.parse(localStorage.getItem("workers")) || [
  { id: 1, name: "Moritz Löhmann" },
  { id: 2, name: "Eduard Kovalov" },
  { id: 3, name: "Hassan Daud" }
];

function saveWorkers() {
  localStorage.setItem("workers", JSON.stringify(workers));
}

/* ===== RENDER ===== */
function render() {
  const list = document.getElementById("presentList");
  list.innerHTML = "";
  workers.forEach(w => {
    list.innerHTML += `
      <label>
        <input type="checkbox" value="${w.id}"> ${w.name}
      </label>`;
  });

  const adminList = document.getElementById("workerList");
  adminList.innerHTML = "";
  workers.forEach(w => {
    adminList.innerHTML += `
      <li>${w.name}
        <button onclick="removeWorker(${w.id})">-</button>
      </li>`;
  });
}
render();

/* ===== ADMIN ===== */
function openAdmin() {
  const u = prompt("Nome utente:");
  const p = prompt("Password:");
  if (u === "Shkodran" && p === "Shkodran2006@") {
    adminPanel.style.display = "block";
    mainPanel.style.display = "none";
  } else alert("Credenziali errate");
}

function closeAdmin() {
  adminPanel.style.display = "none";
  mainPanel.style.display = "block";
}

function addWorker() {
  const name = newName.value.trim();
  if (!name) return;
  workers.push({ id: Date.now(), name });
  saveWorkers();
  render();
  newName.value = "";
}

function removeWorker(id) {
  workers = workers.filter(w => w.id !== id);
  saveWorkers();
  render();
}

/* ===== GENERAZIONE ROTAZIONI ===== */
function generateRotations() {
  const rot = parseInt(document.getElementById("rotations").value);
  let text = "";

  for (let r = 1; r <= rot; r++) {
    text += `===== ROTAZIONE ${r} =====\n`;
    text += generateSingleShift();
    text += "\n\n";
  }

  document.getElementById("output").value = text;
}

/* ===== SINGOLA ROTAZIONE ===== */
function generateSingleShift() {
  const selectedIds = [...document.querySelectorAll("#presentList input:checked")]
    .map(i => parseInt(i.value));

  const need = document.querySelector("input[name='need']:checked").value;

  let people = workers
    .filter(w => selectedIds.includes(w.id))
    .map(w => ({ ...w, fatigue: Math.random(), assigned: false }));

  let out = "";

  const take = () => people.filter(p => !p.assigned)
    .sort((a,b)=>a.fatigue-b.fatigue)[0];

  /* TRIAGE */
  out += "SSCC Druck\n\t" + take()?.name + "\n";
  for (let i=1;i<=3;i++) out += "Separation "+i+"\n\t"+take()?.name+"\n";
  out += "Band aufgeben SX\n\t"+take()?.name+"\n";
  out += "Band aufgeben DX\n\t"+take()?.name+"\n";

  /* STAMMDATEN */
  let sd = need==="midi"?1:3;
  for (let i=1;i<=sd;i++) out += "Stammdaten "+i+"\t"+take()?.name+"\n";

  /* MIDI */
  for (let i=1;i<=10;i++) {
    let p = take();
    if (!p) break;
    out += "Midi "+i+"\t"+p.name+"\n";
  }

  return out;
}
</script>

</body>
</html>
